// pvinis ergodox ez
// qmk flash --keyboard ergodox_ez --keymap pvinis
// ,------------------------------------.          ┌────┬────┬────┬────┬────┬────┬──────┐
// |      |    |    |    |    |    |    |          │    │    │    │    │    │    │      │
// |------+----+----+----+----+---------|          ├────┼────┼────┼────┼────┼────┼──────┤
// |      |    |    |    |    |    |    |          │    │    │    │    │    │    │      │
// |------+----+----+----x----x----|    |          │    ├────╆━━━━╅────┼────┼────┼──────┤
// |      |    |    |    |    |    |----|          ├────┤    ┃    ┃    │    │    │      │
// |------+----+----+----x----x----|    |          │    ├────╄━━━━╃────┼────┼────┼──────┤
// |      |    |    |    |    |    |    |          │    │    │    │    │    │    │      │
// `------+----+----+----+----+---------'          └────┴────┼────┼────┼────┼────┼────┬─┘
//   |    |    |    |    |    |                              │    │    │    │    │    │
//   `------------------------'                              └────┴────┴────┴────┴────┘
//                              ,---------.      ┌────┬────┐
//                              |    |    |      │    │    │
//                         ,----+----+----|      ├────┼────┼────┐
//                         |    |    |    |      │    │    │    │
//                         |    |    |----|      ├────┤    │    │
//                         |    |    |    |      │    │    │    │
//                         `--------------'      └────┴────┴────┘


#include QMK_KEYBOARD_H
#include "pvinis.h"


const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    // ,------------------------------------.          ,------------------------------------.
    // |      |    |    |    |    |    |    |          |    |    |    |    |    |    |      |
    // |------+----+----+----+----+---------|          |----+----+----+----+----+----+------|
    // | Tab  |    |    |    |    |    |    |          |    |    |    |    |    |    |      |
    // |------+----+----+----x----x----|    |          |    |----x----x----+----+----+------|
    // |EscCtl|    |    |    |    |    |----|          |----|    |    |    |    |    | Ent  |
    // |------+----+----+----x----x----|    |          |    |----x----x----+----+----+------|
    // |LShift|    |    |    |    |    |    |          |    |    |    |    |    |    |RShift|
    // `------+----+----+----+----+---------'          `---------+----+----+----+----+------'
    //   |    |    |    |Cmd |LOWR|                              |RASE|RAlt|    |    |    |
    //   `------------------------'                              `------------------------'
    //                              ,---------.      ,---------.
    //                              |QWER|    |      |    |    |
    //                         ,----+----+----|      |----+----+----.
    //                         | Ba | L  |    |      |    |    |    |
    //                         | ck |Shi |----|      |----|    |Spc |
    //                         | spc| ft |    |      |    |    |    |
    //                         `--------------'      `--------------'
    [LR_BASE] = LAYOUT_ergodox_pretty_wrapper(
        _______, _______, _______, _______, _______, _______, DM_REC1,      _______, _______, _______, _______, _______, _______, _______,
        KC_TAB , _______, _______, _______, _______, _______, DM_PLY1,      _______, _______, _______, _______, _______, _______, _______,
        PV_ESCC, _______, _______, _______, _______, _______,                        _______, _______, _______, _______, _______, KC_ENT ,
        KC_LSFT, _______, _______, _______, _______, _______, _______,      _______, _______, _______, _______, _______, _______, KC_RSFT,
        _______, _______, _______, KC_LGUI, SYMBOL ,                                          SYSCTL , SYSCTL2, _______, _______, _______,
                                                     _______ , _______,      _______, _______,
                                                              _______,      _______,
                                            KC_BSPC, KC_LSFT, KC_LWIN,      _______, KC_LSFT, KC_SPC
    ),

  // ,------------------------------------.          ,------------------------------------.
  // |      |        NUMBERS_L       |    |          |    |        NUMBERS_R       |      |
  // |------+----+----+----+----+---------|          |----+----+----+----+----+----+------|
  // |      |                        |    |          |    |                        |      |
  // |------+                        |    |          |    |                        +------|
  // |      |         QWERTY_L       |----|          |----|         QWERTY_R       |      |
  // |------+                        |    |          |    |                        +------|
  // |      |                        |    |          |    |                        |      |
  // `------+----+----+----+----+---------'          `---------+----+----+----+----+------'
  //   |    |    |    |    |    |                              |    |    |    |    |    |
  //   `------------------------'                              `------------------------'
  //                              ,---------.      ,---------.
  //                              |    |    |      |    |    |
  //                         ,----+----+----|      |----+----+----.
  //                         |    |    |    |      |    |    |    |
  //                         |    |    |----|      |----|    |    |
  //                         |    |    |    |      |    |    |    |
  //                         `--------------'      `--------------'
  // See `users/pvinis/pvinis.h`
  [LR_QWERTY] = LAYOUT_ergodox_pretty_wrapper(
    _______, ________________NUMBERS_L__________________, DM_REC1,      _______, ________________NUMBERS_R__________________, _______,
    _______, _________________QWERTY_L1_________________, DM_PLY1,      _______, _________________QWERTY_R1_________________, _______,
    _______, _____________MOD_QWERTY_L2_________________,                        _________________QWERTY_R2_________________, _______,
    _______, _________________QWERTY_L3_________________, _______,      _______, _________________QWERTY_R3_________________, _______,
    _______, _______, _______, _______, _______,                                          _______, _______, _______, _______, _______,
                                                 _______, _______,      _______, _______,
                                                          _______,      _______,
                                        _______, _______, _______,      _______, _______, _______
  ),

  // See `users/pvinis/pvinis.h`
  [LR_SYMBOL] = LAYOUT_ergodox_pretty_wrapper(
    _______, ______________________F_L__________________, KC_F11 ,      KC_F12 , ______________________F_R__________________, _______,
    _______, _________________SYMBOL_L1_________________, _______,      _______, _________________SYMBOL_R1_________________, _______,
    _______, _________________SYMBOL_L2_________________,                        _________________SYMBOL_R2_________________, _______,
    _______, _________________SYMBOL_L3_________________, _______,      _______, _________________SYMBOL_R3_________________, _______,
    _______, _______, _______, _______, _______,                                          _______, _______, _______, _______, _______,
                                                 _______, _______,      _______, _______,
                                                          _______,      _______,
                                        _______, _______, _______,      _______, _______, _______
  ),

    // See `users/pvinis/pvinis.h`
    [LR_SYSCTL] = LAYOUT_ergodox_pretty_wrapper(
        _______, _______, _______, _______, _______, _______, _______,      _______, _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______, _______,      _______, _________________SYSCTL_R1_________________, _______,
        _______, _______, _______, _______, _______, _______,                        _________________SYSCTL_R2_________________, _______,
        _______, _______, _______, _______, _______, _______, _______,      _______, _________________SYSCTL_R3_________________, _______,
        _______, _______, _______, _______, _______,                                          _______, _______, _______, _______, _______,
                                                     _______, _______,      _______, _______,
                                                              _______,      _______,
                                            _______, _______, _______,      _______, _______, _______
    ),

    // See `users/pvinis/pvinis.h`
    [LR_SYSCTL2] = LAYOUT_ergodox_pretty_wrapper(
        _______, _______, _______, _______, _______, _______, _______,      _______, ________________SYSCTL2_R0_________________, _______,
        _______, ___________________________________________, _______,      _______, ________________SYSCTL2_R1_________________, _______,
        _______, _______, _______, _______, _______, _______,                        ________________SYSCTL2_R2_________________, _______,
        _______, _______, _______, _______, _______, _______, _______,      _______, ________________SYSCTL2_R3_________________, _______,
        _______, _______, _______, _______, _______,                                          _______, _______, _______, _______, _______,
                                                     _______, _______,      _______, _______,
                                                              _______,      _______,
                                            _______, _______, _______,      _______, _______, _______
    ),

  // See `users/pvinis/pvinis.h`
  [LR_KBCTL] = LAYOUT_ergodox_pretty_wrapper(
    XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,      XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
    XXXXXXX, __________________KBCTL_L1_________________, XXXXXXX,      XXXXXXX, __________________KBCTL_R1_________________, XXXXXXX,
    XXXXXXX, __________________KBCTL_L2_________________,                        __________________KBCTL_R2_________________, XXXXXXX,
    XXXXXXX, __________________KBCTL_L3_________________, XXXXXXX,      XXXXXXX, __________________KBCTL_R3_________________, XXXXXXX,
    XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, _______,                                          _______, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,

                                                 XXXXXXX, XXXXXXX,      XXXXXXX, XXXXXXX,
                                                          XXXXXXX,      XXXXXXX,
                                        XXXXXXX, XXXXXXX, XXXXXXX,      XXXXXXX, XXXXXXX, XXXXXXX
  ),

    // ,--------------------------------------------------.
    // |   esc  |   1  |   2  |   3  |   4  |   5  |     |
    // |--------+------+------+------+------+-------------|
    // |   tab  |   Q  |   W  |   E  |   R  |   T  |      |
    // |--------+------+------+------+------+------|      |
    // |  ctrl  |   A  |   S  |   D  |   F  |   G  |------|
    // |--------+------+------+------+------+------|      |
    // |  shift |   Z  |   X  |   C  |   V  |   B  |      |
    // `--------+------+------+------+------+-------------'
    //   |      |      |      |      |  spc |
    //   `----------------------------------'
    //                                        ,-------------.
    //                                        |      |      |
    //                                 ,------|------|------|
    //                                 |      |      |      |
    //                                 |  alt |  M   |------|
    //                                 |      |      |      |
    //                                 `--------------------'
    [LR_WARZONE] = LAYOUT_ergodox_pretty_wrapper(
        KC_ESC , ________________NUMBERS_L__________________, _______,     _______, ________________NUMBERS_R__________________, _______,
        KC_TAB , _________________QWERTY_L1_________________, _______,     _______, _________________QWERTY_R1_________________, _______,
        KC_LCTL, _________________QWERTY_L2_________________,                       _________________QWERTY_R2_________________, _______,
        KC_LSFT, _________________QWERTY_L3_________________, _______,     _______, _________________QWERTY_R3_________________, _______,
        KC_CAPS, _______, _______, _______, KC_SPC ,                                      _______, _______, _______, _______, _______,
                                                  _______, _______,     _______, _______,
                                                           _______,     _______,
                                          KC_LALT, KC_M  , KC_LWIN,     _______, _______, _______
    ),
    [LR_GAME2] = LAYOUT_ergodox_pretty_wrapper(
        KC_ESC , ________________NUMBERS_L__________________, _______,     _______, ________________NUMBERS_R__________________, _______,
        KC_TAB , _________________QWERTY_L1_________________, _______,     _______, _________________SYSCTL_R1_________________, _______,
        KC_LCTL, _________________QWERTY_L2_________________,                       _________________SYSCTL_R2_________________, _______,
        KC_LSFT, _________________QWERTY_L3_________________, _______,     _______, _________________SYSCTL_R3_________________, _______,
        _______, _______, _______, _______, KC_SPC ,                                      _______, _______, _______, _______, _______,
                                                  _______, _______,     _______, _______,
                                                           _______,     _______,
                                          KC_LALT, KC_M  , KC_LWIN,     _______, _______, _______
    ),
};


// keyboard initialization
void keyboard_post_init_user_keymap(void) {
    layer_on(LR_QWERTY);

    ergodox_led_all_on();
  for (int i = LED_BRIGHTNESS_HI; i > LED_BRIGHTNESS_LO; i--) {
    ergodox_led_all_set(i);
    wait_ms(5);
  }
  wait_ms(1000);
  for (int i = LED_BRIGHTNESS_LO; i > 0; i--) {
    ergodox_led_all_set(i);
    wait_ms(10);
  }
  ergodox_led_all_off();

  // restore default brightness for future use
  ergodox_led_all_set(LED_BRIGHTNESS_HI);
}

// light up leds based on the layer
uint32_t layer_state_set_user_keymap(uint32_t state) {
  ergodox_right_led_1_off();
  ergodox_right_led_2_off();
  ergodox_right_led_3_off();
  switch (biton32(state)) {
  case LR_SYSCTL:
    ergodox_right_led_3_on(); // blue
    break;
  case LR_KBCTL:
    ergodox_right_led_1_on(); // red
    break;
  case LR_SYMBOL:
    ergodox_right_led_2_on(); // green
    break;
  default: break;
  }
  return state;
}

bool process_record_keymap(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        default:
            return true;
    }
}

void dynamic_macro_record_start_user(void) {
    dynamic_macro_led_blink();
    layer_on(LR_QWERTY);
}

void dynamic_macro_record_end_user(int8_t direction) {
    layer_on(LR_QWERTY);
}
